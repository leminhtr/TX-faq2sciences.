<!DOCTYPE html>
<html>
<head>
	<title></title>
	    <!-- Load plotly js -->
    <script src="plotly-latest.min.js"></script>

    <!-- include jStat, from the CDN or otherwise -->
    <script src="./jStat/jstat.js"></script> 

    <script src="es_query.js"></script>
</head>
<body>

<script src="factory_data_to_plot.js" ></script>

<div id="test"></div>

<script type="text/javascript">
	
var test= Object.create(CLASS_DATA);
test.from=0;
test.size=800;

test.query={
  "aggs": {
    "result": {
      "filter": {
        "bool": {
          "must": [
            {
              "match": {
                "type": "XContentApi"
              }
            },
            {
              "match": {
                "depot_path": "UL-Bio"
              }
            },
                        {
              "match": {
                "depot_path": "UL"
              }
            },
                        {
              "match": {
                "depot_path": "Partenaires"
              }
            },

            {
              "exists": {
                "field": "score_scaled"
              }
            }
            
          ],
          "must_not":
                [
                  {"match" : {"question_id":"j74GTDxCdUh1AhUJbxzOCg"} },
                  {"match" : {"question_id":"i6nRY2FhjtlKF4kAuRVlLi"} },
                  {"match" : {"question_id":"Ro8Bn94sH5fiObRDLGMDub"} },
                  {"match" : {"question_id":"AXGE9teKhMdo4j0BsK6x8f"} },
                  {"match" : {"question_id":"BdYLqQ15ObfDNWH4r8ES1d"} },
                  {"match" : {"question_id":"XSSBiN8sCL10gnc6XsIUi"} },
                  {"match" : {"question_id":"ImUQEzT8sjgXe0C5WIYD9g"} },
                  {"match" : {"question_id":"QWGy9VVCetknLGk0eUfkvc"} },
                  {"match" : {"question_id":"LWF7Tquh7XgWIQLImXgie"} },
                  {"match" : {"question_id":"XSSBiN8sCL10gnc6XsIUi"} },
                    {"match": {"depot_path":"Phy01"}}
                ]
        }
      },
      "aggs": {
        "avg_user": {
          "terms": {
            "field": "user.raw",
            "size": "1000",
            "order":{"score_avg" : "desc"}
          },
          "aggs": {
            "score_avg": {
              "avg": {
                "field": "score_scaled"
              }
            }
          }
        }
      }
    }
  }
}

test.xLabel="étudiant";
test.yLabel="Score moyen d'un étudiant";
test.title="Score moyen d'un étudiant au test de biologie";
test.mean_label="Score total moyen des étudiants";
test.stdev_lower_label="Score total moyen des étudiants - l'écart type";
test.stdev_upper_label="Score total moyen des étudiants + l'écart type";
test.DOM_id="test";
test.format_result= function avg_test_format(response_to_format){
    var agreg_avg=[];
    agreg_avg=response_to_format.aggregations.result.avg_user.buckets; //=array de [{doc_count:..., key:..., score_avg:{value:...}}, {}, ... ]    	    

    return agreg_avg;
}

query(readData,test);






</script>

</body>
</html>