<!DOCTYPE html>
<html>
<head>
	<title></title>
	    <!-- Load plotly js -->
    <script src="plotly-latest.min.js"></script>

    <!-- include jStat, from the CDN or otherwise -->
    <script src="./jStat/jstat.js"></script> 

    <script src="es_query.js"></script>
</head>
<body>

<script src="factory_data_to_plot.js" ></script>

<div id="test"></div>

<script type="text/javascript">
	
var test= Object.create(CLASS_DATA);
test.from=0;
test.size=800;

test.query={
  "aggs": {
    "result": {
      "filter": {
        "bool": {
          "must": [
            {
              "match": {
                "type": "XContentApi"
              }
            },
            {
              "match": {
                "depot_path": "UL-Phy01"
              }
            },
                        {
              "match": {
                "depot_path": "UL"
              }
            },
                        {
              "match": {
                "depot_path": "Partenaires"
              }
            },

            {
              "exists": {
                "field": "score_scaled"
              }
            }
            
          ],
          "must_not":
                [
                  {"match": {"question_id":"qgMx9nWg3feUknCfwecgli"}},
                  {"match": {"question_id":"pky45GVJlvk0YYYe0wiTxe"}},
                  {"match": {"question_id":"KDiQi0UNikeZBzySvmA2k"}},
                  {"match": {"question_id":"Dvj5AqVq4RiIbIFWaJuSud"}},
                  {"match": {"question_id":"qVTVybVQlxckqCv1EI54h"}},
                  {"match": {"question_id":"udFJDEATISe7oQfqnd9Kki"}},
                    {"match": {"depot_path":"Bio"}}
                ]
        }
      },
      "aggs": {
        "avg_user": {
          "terms": {
            "field": "user.raw",
            "size": "1000",
            "order":{"score_avg" : "desc"}
          },
          "aggs": {
            "score_avg": {
              "avg": {
                "field": "score_scaled"
              }
            }
          }
        }
      }
    }
  }
}

test.xLabel="étudiant";
test.yLabel="Score moyen d'un étudiant";
test.title="Score moyen d'un étudiant au test de physique";
test.mean_label="Score total moyen des étudiants";
test.stdev_lower_label="Score total moyen des étudiants - l'écart type";
test.stdev_upper_label="Score total moyen des étudiants + l'écart type";
test.DOM_id="test";
test.format_result= function avg_test_format(response_to_format){
    var agreg_avg=[];
    agreg_avg=response_to_format.aggregations.result.avg_user.buckets; //=array de [{doc_count:..., key:..., score_avg:{value:...}}, {}, ... ]    	    

    return agreg_avg;
}

query(readData,test);






</script>

</body>
</html>